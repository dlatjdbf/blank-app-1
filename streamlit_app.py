import streamlit as st
import datetime
import calendar
import json
import os

# ------------------- ê¸°ë³¸ ì„¤ì • -------------------
KST = datetime.timezone(datetime.timedelta(hours=9))
today = datetime.datetime.now(KST).date()
st.set_page_config(page_title="ì¹´í˜ì¸ ê´€ë¦¬ ì•±", layout="centered")

# ------------------- ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° -------------------
DATA_FILE = "data.json"
if os.path.exists(DATA_FILE):
    with open(DATA_FILE, "r", encoding="utf-8") as f:
        st.session_state.data = json.load(f)
else:
    st.session_state.data = {}

# ------------------- ìƒíƒœ ì´ˆê¸°í™” -------------------
if "page" not in st.session_state:
    st.session_state.page = "home"
if "intake_input" not in st.session_state:
    st.session_state.intake_input = 0
if "selected_products" not in st.session_state:
    st.session_state.selected_products = []
if "selected_article" not in st.session_state:
    st.session_state.selected_article = None

# ------------------- ì•„ì¹´ì´ë¸Œ ê¸€ ë°ì´í„° -------------------
archive_articles = {
    "ì¹´í˜ì¸ì˜ ì¸ì²´ ì‘ìš©ê³¼ ë¶€ì‘ìš©, ê·¸ë¦¬ê³  ê°œì¸ì°¨ì™€ ì²­ì†Œë…„ ì£¼ì˜ì‚¬í•­": """
### ì¹´í˜ì¸ì˜ ì¸ì²´ ì‘ìš©ê³¼ ë¶€ì‘ìš©

ìš”ì¦˜ì€ í•˜ë£¨ í•œë‘ ì”ì˜ ì»¤í”¼ê°€ ì¼ìƒì´ ë˜ì—ˆì§€ë§Œ,  
ì»¤í”¼ë¥¼ ìì£¼ ì°¾ê²Œ ë˜ëŠ” ì´ìœ ëŠ” ë‹¨ìˆœí•œ ìŠµê´€ì´ ì•„ë‹ˆë‹¤.  
ê·¸ ì¤‘ì‹¬ì—ëŠ” â€˜ì¹´í˜ì¸â€™ì´ë¼ëŠ” ì„±ë¶„ì´ ìˆë‹¤.  

ì¹´í˜ì¸ì€ ì¤‘ì¶”ì— ì‘ìš©í•´ ëª¸ì„ ê¹¨ìš°ê³  ì§‘ì¤‘ë ¥ì„ ë†’ì´ëŠ” íš¨ê³¼ê°€ ìˆìœ¼ë©°,  
ì§„í†µì œë‚˜ ê°ê¸°ì•½ì—ë„ í¬í•¨ë˜ì–´ ë‘í†µ ì™„í™”ì— ë„ì›€ì„ ì£¼ê¸°ë„ í•œë‹¤.  
í•˜ì§€ë§Œ ê³¼í•˜ê²Œ ì„­ì·¨í•˜ë©´ ê±´ê°•ì— ì¢‹ì§€ ì•Šì€ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.  

ê·¸ë ‡ë‹¤ë©´ ì¹´í˜ì¸ì€ ì–´ë–¤ ì›ë¦¬ë¡œ ìš°ë¦¬ ëª¸ì— ì‘ìš©í• ê¹Œ?  
ì¹´í˜ì¸ì€ ì‹ ì²´ì˜ ì—ë„ˆì§€ ëŒ€ì‚¬ë¥¼ ì´‰ì§„í•˜ëŠ” ì½”ë¥´í‹°ì†” í˜¸ë¥´ëª¬ ë¶„ë¹„ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.  
ë˜í•œ ë‡Œì—ì„œ í¥ë¶„ì„ ì–µì œí•˜ëŠ” ì±„ë„ì˜ í™œì„±í™”ë¥¼ ë§‰ì•„  
ì‹ ê²½ì„¸í¬ê°€ ë” í™œë°œí•˜ê²Œ ë°˜ì‘í•˜ë„ë¡ ë§Œë“ ë‹¤.  
ì´ë¡œ ì¸í•´ ì¼ì‹œì ìœ¼ë¡œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ê³ ,  
í–‰ë³µê°ê³¼ í™œë ¥ì´ ëŠê»´ì§€ëŠ” ê°ì„± íš¨ê³¼ê°€ ë‚˜íƒ€ë‚œë‹¤.  

ê·¸ëŸ¬ë‚˜ ì¹´í˜ì¸ì„ ê³¼ë‹¤í•˜ê²Œ ì„­ì·¨í•˜ë©´  
ë¶ˆë©´, ì‹¬ì¥ì´ ë¹ ë¥´ê²Œ ë›°ëŠ” ì‹¬ê³„í•­ì§„, í˜ˆì•• ìƒìŠ¹, ì†ì˜ ë–¨ë¦¼,  
ë¶ˆì•ˆê° ê°™ì€ ë¶€ì‘ìš©ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤.  

ì¹´í˜ì¸ì€ ê¸€ë£¨íƒ€ë¯¼ê³¼ ë„íŒŒë¯¼ì˜ ë¶„ë¹„ë„ í•¨ê»˜ ì¦ê°€ì‹œí‚¤ëŠ”ë°,  
ì¹´í˜ì¸ì˜ ê°ì„±ì‘ìš©ê³¼ ì§‘ì¤‘ë ¥ ì¦ê°€ëŠ” ì´ ê°™ì€ â€˜í¥ë¶„ íš¨ê³¼â€™ë¡œ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤.  
íŠ¹íˆ ì¹´í˜ì¸ ëŒ€ì‚¬ê°€ ëŠë¦° ì‚¬ëŒì€  
ì¹´í˜ì¸ì´ ì„­ì·¨ëŸ‰ì´ ëŠ˜ì–´ë‚˜ë©´ ì‹¬ì¥ ì§ˆí™˜ì´ë‚˜ ê³ í˜ˆì••, ì‹ ì¥ ì§ˆí™˜ì˜ ìœ„í—˜ì´ ì»¤ì§„ë‹¤ê³  ì•Œë ¤ì ¸ ìˆë‹¤.  
ë°˜ëŒ€ë¡œ ëŒ€ì‚¬ê°€ ë¹ ë¥¸ ì‚¬ëŒì€ ê°™ì€ ì–‘ì„ ë§ˆì…”ë„ ê°ì„± íš¨ê³¼ê°€ ë¹¨ë¦¬ ì‚¬ë¼ì§„ë‹¤.  

---

### ì¹´í˜ì¸ê³¼ ìˆ˜ë©´ì˜ ê´€ê³„

ì»¤í”¼ë¥¼ ë§ˆì‹œë©´ ì ì´ ì˜¤ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë°”ë¡œ ì•„ë°ë…¸ì‹  ìˆ˜ìš©ì²´ ë•Œë¬¸ì´ë‹¤.  
ìš°ë¦¬ ëª¸ì€ ê¹¨ì–´ ìˆì„ ë•Œ ì•„ë°ë…¸ì‹ ì´ë¼ëŠ” ë¬¼ì§ˆì„ ì ì  ì¶•ì í•˜ëŠ”ë°,  
ì´ ì•„ë°ë…¸ì‹ ì´ ìˆ˜ìš©ì²´ì— ê²°í•©í•˜ë©´ í”¼ë¡œë¥¼ ëŠë¼ê³  ì ì´ ì˜¨ë‹¤.  

ê·¸ëŸ°ë° ì•„ë°ë…¸ì‹  ìˆ˜ìš©ì²´ëŠ” ì¹´í˜ì¸ê³¼ ì•„ë°ë…¸ì‹ ì„ êµ¬ë¶„í•˜ì§€ ëª»í•œë‹¤.  
ì¹´í˜ì¸ì„ ì„­ì·¨í•˜ë©´ ìˆ˜ìš©ì²´ê°€ ì•„ë°ë…¸ì‹  ëŒ€ì‹  ì¹´í˜ì¸ì„ ë°›ì•„ë“¤ì´ê²Œ ëœë‹¤.  
ê²°êµ­ ìˆ˜ë©´ ì‘ìš© ëŒ€ì‹  ê°ì„±ì‘ìš©ì´ ë°œìƒí•œë‹¤.  

ì´ë•Œ ëª¸ì†ì˜ ì¹´í˜ì¸ì´ ë¶„í•´ë˜ê¸° ì „ì—ëŠ”  
ëª¸ì´ ë‹¤ì‹œ ìì—°ìŠ¤ëŸ½ê²Œ ì ë“¤ê¸° ì–´ë µë‹¤.  
ê·¸ë˜ì„œ ìê¸° ì „ ì»¤í”¼ë¥¼ ë§ˆì‹œë©´  
ì´ ìˆ˜ë©´ ì‹œê°„ì´ ì¤„ì–´ë“¤ê±°ë‚˜, ìˆ˜ë©´ì˜ ì§ˆì´ ë‚˜ë¹ ì§€ê²Œ ëœë‹¤.  

ë‹¤ë§Œ ì´ íš¨ê³¼ì˜ ê°•ë„ëŠ” ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥´ë‹¤.  
ì¹´í˜ì¸ì„ ë¹¨ë¦¬ ë¶„í•´í•˜ëŠ” ìœ ì „ìë¥¼ ê°€ì§„ ì‚¬ëŒì€ ë°˜ê°ê¸°ê°€ ì§§ì•„  
ê°ì„± íš¨ê³¼ê°€ ê¸ˆë°© ì‚¬ë¼ì§€ì§€ë§Œ,  
ëŒ€ì‚¬ê°€ ëŠë¦¬ê±°ë‚˜ ì•„ë°ë…¸ì‹  ìˆ˜ìš©ì²´ê°€ ì ì€ ì‚¬ëŒì€  
ì»¤í”¼ í•œ ì”ë§Œìœ¼ë¡œë„ ì˜¤ë«ë™ì•ˆ ì ë“¤ê¸° í˜ë“¤ë‹¤.  

ë˜ ì»¤í”¼ë¥¼ ë§ˆì‹  ë’¤ ì ì´ ì˜ ì˜¨ë‹¤ëŠ” ì‚¬ëŒë„  
ì¹´í˜ì¸ì–‘ì´ ë§ê±°ë‚˜ ì ë“¤ê¸° ì–¼ë§ˆ ì „ì— ì»¤í”¼ë¥¼ ë§ˆì‹œë©´  
ì¼ë¶€ ì•„ë°ë…¸ì‹  ìˆ˜ìš©ì²´ê°€ ì¹´í˜ì¸ê³¼ ê²°í•©í•œ ìƒíƒœê°€ ë˜ê³ ,  
ê¹Šì€ ì ì´ ì¤„ê³  ì–•ì€ ì ì´ ì¦ê°€í•´  
ìê°í•˜ì§€ ëª»í•˜ëŠ” ìƒíƒœë¡œ ìˆ˜ë©´ì˜ ì§ˆì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤.  

---

### ì²­ì†Œë…„ì€ íŠ¹íˆ ì£¼ì˜í•´ì•¼ í•´ìš”

ì¹´í˜ì¸ì€ í¥ë¶„Â·ì¤‘ë…ì„± ì•½ë¬¼ì´ë‹¤.  
ì¹´í˜ì¸ ë³µìš© í›„ ì§€ë‚˜ì¹œ ë„íŒŒë¯¼ ë¶„ë¹„ë¡œ ì¸í•œ ì¤‘ë… ê°€ëŠ¥ì„±ì€  
ë‡Œì˜ ë¯¼ê°ë„ê°€ ë†’ì€ ì–´ë¦° ë‚˜ì´ì¼ìˆ˜ë¡ ë”ìš± ê°•í•´ì§ˆ ìˆ˜ ìˆë‹¤.  

ë˜í•œ ì¹´í˜ì¸ì€ ì„±ì¥ê¸° ë‡Œ ì„¸í¬ ë°œë‹¬ì—ë„ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìœ¼ë¯€ë¡œ,  
ì²­ì†Œë…„ì€ ê°€ëŠ¥í•˜ë©´ ì—ë„ˆì§€ìŒë£Œë‚˜ ê³ ì¹´í˜ì¸ ìŒë£Œ ì„­ì·¨ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ ì¢‹ë‹¤.
""",

    "ì»¤í”¼ì˜ ì¹´í˜ì¸ í•¨ëŸ‰ì´ ì¼ì •í•˜ì§€ ì•Šë‹¤ê³ ?": """
ë§¤ì¼ ì»¤í”¼ë¥¼ ë§ˆì‹œëŠ” ì‚¬ëŒì´ë¼ë©´ í•œ ë²ˆì¯¤ ì´ëŸ° ê²½í—˜ì´ ìˆì„ ê±°ë‹¤.  
ì–´ë–¤ ë‚ ì€ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ë¨¸ë¦¬ê°€ ë§‘ì•„ì§€ê³  ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ”ë°,  
ë‹¤ë¥¸ ë‚ ì—” ê´œíˆ ê°€ìŠ´ì´ ë‘ê·¼ê±°ë¦¬ê³  ë¶ˆì•ˆí•˜ê±°ë‚˜,  
ë˜ ì–´ë–¤ ë‚ ì€ ë§ˆì…¨ëŠ”ë°ë„ ì¡¸ë¦¬ê¸°ê¹Œì§€ í•˜ë‹¤.  

ì´ ì°¨ì´ëŠ” ë‹¨ìˆœíˆ ì»¨ë””ì…˜ ë•Œë¬¸ì´ ì•„ë‹ˆë¼,  
ì»¤í”¼ ì† â€˜ì¹´í˜ì¸ í•¨ëŸ‰â€™ì´ ì¼ì •í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë¼ëŠ” ì‚¬ì‹¤ì´  
ì—¬ëŸ¬ ì—°êµ¬ë¡œ ë°í˜€ì¡Œë‹¤.  

ë¯¸êµ­ì˜ ë²•ì˜í•™ì ë¸Œë£¨ìŠ¤ ê³¨ë“œë²„ê±°ëŠ” 2003ë…„,  
ì—¬ëŸ¬ ë¸Œëœë“œì˜ ì»¤í”¼ë¥¼ ì§ì ‘ êµ¬ì…í•´ ì¹´í˜ì¸ ì–‘ì„ ë¶„ì„í–ˆë‹¤.  
ê·¸ ê²°ê³¼, ê°™ì€ ì–‘ì˜ ì»¤í”¼ë¼ë„ ì œí’ˆë§ˆë‹¤ ì¹´í˜ì¸ ë†ë„ê°€ í¬ê²Œ ë‹¬ëë‹¤.  

ìŠ¤í˜ì…œí‹° ì»¤í”¼ì˜ í‰ê·  ë†ë„ëŠ” 29.5mlë‹¹ 12mgìœ¼ë¡œ,  
í•œ ì”(ì•½ 147ml)ì—ëŠ” ì•½ 60mgì˜ ì¹´í˜ì¸ì´ ë“¤ì–´ ìˆì—ˆë‹¤.  
í•˜ì§€ë§Œ 1996ë…„ ì—°êµ¬ì—ì„œ ì œì‹œëœ ê¸°ì¤€ì¹˜(85mg)ë³´ë‹¤ 40%ë‚˜ ë‚®ì€ ìˆ˜ì¹˜ì˜€ë‹¤.  
ê·¸ëŠ” ë˜ í•œ ê°€ì§€ í¥ë¯¸ë¡œìš´ ì ì„ ì§€ì í–ˆë‹¤.  
ì»¤í”¼ì˜ ì¹´í˜ì¸ ë†ë„ëŠ” ë‚®ì•„ì¡Œì§€ë§Œ, ì»¤í”¼ì”ì˜ í¬ê¸°ëŠ” ì˜¤íˆë ¤ ì»¤ì¡Œë‹¤ëŠ” ê²ƒì´ë‹¤.  

ìš”ì¦˜ íŒë§¤ë˜ëŠ” â€˜ì‘ì€ ì‚¬ì´ì¦ˆâ€™ ì»¤í”¼ì¡°ì°¨ 295ml ì •ë„ì´ë©°,  
ìŠ¤íƒ€ë²…ìŠ¤ì˜ ê·¸ë€ë° ì‚¬ì´ì¦ˆ(472ml) í•œ ì”ì—ëŠ”  
ê°™ì€ ì–‘ì˜ ë˜í‚¨ë„ë„ˆì¸  ì»¤í”¼ì˜ ë‘ ë°°ì— ê°€ê¹Œìš´ ì¹´í˜ì¸ì´ ë“¤ì–´ ìˆì—ˆë‹¤.  
ì‹¬ì§€ì–´ ê°™ì€ ë§¤ì¥ì—ì„œ ê°™ì€ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•´ë„ í•¨ëŸ‰ì´ ì¼ì •í•˜ì§€ ì•Šì•˜ë‹¤.  

ê³¨ë“œë²„ê±°ëŠ” 6ì¼ ì—°ì† ê°™ì€ ë¸”ë Œë“œ ì»¤í”¼ë¥¼ êµ¬ì…í–ˆëŠ”ë°,  
ì¹´í˜ì¸ ì–‘ì€ í•˜ë£¨ëŠ” 260mg, ë˜ ë‹¤ë¥¸ ë‚ ì€ 564mgìœ¼ë¡œ  
ë‘ ë°° ì´ìƒ ì°¨ì´ê°€ ë‚¬ë‹¤.  

ì´í›„ ìŠ¤ì½”í‹€ëœë“œì˜ í† ë¨¸ìŠ¤ í¬ë¡œì§€ì–´(2012) ì—°êµ¬íŒ€ë„  
ë¹„ìŠ·í•œ ê²°ê³¼ë¥¼ ë°œí‘œí–ˆë‹¤.  
ê·¸ë“¤ì€ ê¸€ë˜ìŠ¤ê³  ì§€ì—­ì˜ ì—¬ëŸ¬ ì¹´í˜ì—ì„œ êµ¬ì…í•œ ì—ìŠ¤í”„ë ˆì†Œ 20ì”ì„ ë¶„ì„í–ˆëŠ”ë°,  
ê° ì”ì˜ ìš©ëŸ‰ì€ 23.6~70.8mlë¡œ ë‹¤ë¥´ì§€ë§Œ,  
ë¶€í”¼ ì°¨ì´ë¥¼ ê³ ë ¤í•˜ë”ë¼ë„ ì¹´í˜ì¸ ë†ë„ëŠ” ë§¤ìš° ë¶ˆê·œì¹™í–ˆë‹¤.  

ì‹¤ì œ ì¸¡ì • ê²°ê³¼, ì—ìŠ¤í”„ë ˆì†Œ í•œ ì”ì— ë“¤ì–´ ìˆëŠ” ì¹´í˜ì¸ì€  
51mgì—ì„œ 300mg ì´ìƒê¹Œì§€ ë‹¬ëê³ ,  
ì´ë¥¼ 29.5ml ê¸°ì¤€ìœ¼ë¡œ í™˜ì‚°í•œ ë†ë„ëŠ” 56~196mgìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤.  
ì¦‰, ê°™ì€ ìš©ëŸ‰ìœ¼ë¡œ í™˜ì‚°í•´ë„ ìµœëŒ€ 3ë°° ì´ìƒ ì°¨ì´ê°€ ë‚œ ê²ƒì´ë‹¤.  

ì‹¬ì§€ì–´ ìŠ¤íƒ€ë²…ìŠ¤ ì—ìŠ¤í”„ë ˆì†ŒëŠ” ê°€ì¥ ë‚®ì€ 51mg ìˆ˜ì¤€ì´ì—ˆì§€ë§Œ,  
ë‹¤ë¥¸ ì¹´í˜ì—ì„œëŠ” 300mgì„ í›Œì© ë„˜ëŠ” ê²½ìš°ë„ ìˆì—ˆë‹¤.  

ì´ ì—°êµ¬ë“¤ì€ ì¤‘ìš”í•œ ì‚¬ì‹¤ì„ ì•Œë ¤ì¤€ë‹¤.  
ê°™ì€ ìš©ëŸ‰ì˜ ì»¤í”¼ í•œ ì” ì† ì¹´í˜ì¸ í•¨ëŸ‰ì€ ê²°ì½” ì¼ì •í•˜ì§€ ì•Šë‹¤.  
ì›ë‘ì˜ í’ˆì¢…, ì¬ë°° í™˜ê²½, ë¡œìŠ¤íŒ… ì •ë„, ì¶”ì¶œ ê°•ë„ ë“± ì—¬ëŸ¬ ì›ì¸ìœ¼ë¡œ  
ì¹´í˜ì¸ í•¨ëŸ‰ì´ í¬ê²Œ ë‹¬ë¼ì§„ë‹¤.  

ê²°êµ­, ìš°ë¦¬ê°€ ë§¤ì¼ ë§ˆì‹œëŠ” ì»¤í”¼ëŠ” â€˜í•˜ë£¨ì˜ ê¸°ë¶„â€™ì„ ë°”ê¿€ ë§Œí¼  
ì¹´í˜ì¸ ì–‘ì˜ ì°¨ì´ê°€ í¬ë‹¤.  
ê°™ì€ ì¹´í˜, ê°™ì€ ë©”ë‰´ë¼ë„ ì–´ë–¤ ë‚ ì—” ì•ˆì •ì ì´ê³  ì§‘ì¤‘ì´ ì˜ ë˜ì§€ë§Œ,  
ë‹¤ë¥¸ ë‚ ì—” ì‹¬ì¥ì´ ë¹¨ë¦¬ ë›°ê±°ë‚˜ ë¶ˆì•ˆí•´ì§€ëŠ” ì´ìœ â€”  
ê·¸ê±´ ë°”ë¡œ ì»¤í”¼ë§ˆë‹¤, ì‹¬ì§€ì–´ ê°™ì€ ì»¤í”¼ ì•ˆì—ì„œë„  
ì¹´í˜ì¸ í•¨ëŸ‰ì´ ì œê°ê°ì´ê¸° ë•Œë¬¸ì´ë‹¤.
"""
}

# ------------------- í™ˆ í™”ë©´ -------------------
if st.session_state.page == "home":
    st.title("â˜• ì¹´í˜ì¸ ê´€ë¦¬ ì•±")
    st.write("ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”.")

    col1, col2 = st.columns(2)
    with col1:
        if st.button("ğŸ“… ì¹´í˜ì¸ ë‹¬ë ¥", use_container_width=True):
            st.session_state.page = "calendar"
    with col2:
        if st.button("ğŸ“š ì¹´í˜ì¸ ì•„ì¹´ì´ë¸Œ", use_container_width=True):
            st.session_state.page = "archive"

# ------------------- ì¹´í˜ì¸ ë‹¬ë ¥ -------------------
elif st.session_state.page == "calendar":
    st.title("ğŸ“… ì¹´í˜ì¸ ë‹¬ë ¥")
    st.write("ëª©í‘œ ì„­ì·¨ëŸ‰ì„ ì„¤ì •í•˜ê³  ë‹¬ì„± ì—¬ë¶€ë¥¼ ê¸°ë¡í•˜ì„¸ìš”.")

    # í˜„ì¬ ì—°ë„ / ì›”
    year = today.year
    month = st.selectbox("ì›” ì„ íƒ", range(1, 13), index=today.month - 1, format_func=lambda x: f"{x}ì›”")

    # ë‹¬ë ¥ ìƒì„±
    month_days = calendar.monthrange(year, month)[1]
    cols = st.columns(7)
    for i, day in enumerate(range(1, month_days + 1)):
        col = cols[i % 7]
        with col:
            key = f"{year}-{month:02d}-{day:02d}"
            entry = st.session_state.data.get(key)
            label = f"{day}ì¼"
            if entry:
                label += f"\n{entry['intake']}mg {'âœ…' if entry['achieved'] else 'âŒ'}"
            if st.button(label, key=f"btn_{key}"):
                st.session_state.selected_date = key
                st.session_state.intake_input = 0
                st.session_state.selected_products = []

    # ë‚ ì§œ í´ë¦­ ì‹œ ì…ë ¥ì°½
    if "selected_date" in st.session_state:
        date = st.session_state.selected_date
        st.markdown("---")
        st.subheader(f"{date} ê¸°ë¡")

        # ëª©í‘œ ì„­ì·¨ëŸ‰ ì…ë ¥
        goal = st.number_input("ëª©í‘œ ì„­ì·¨ëŸ‰ (mg)", min_value=0, step=10, key="goal_input")

        # ì œí’ˆ ëª©ë¡
        products = {
            "ëª¬ìŠ¤í„° ì—ë„ˆì§€ 355ml": 100,
            "ë ˆë“œë¶ˆ ì—ë„ˆì§€ ë“œë§í¬ 355ml": 88.75,
            "í•«ì‹ìŠ¤ ë”í‚¹ íŒŒì›Œ 355ml": 100,
            "í•«ì‹ìŠ¤ ë”í‚¹ í¬ëŸ¬ì‰¬í”¼ì¹˜ 355ml": 100,
            "í•«ì‹ìŠ¤ ë”í‚¹ í¼í”Œê·¸ë ˆì´í”„ 355ml": 100,
            "í•«ì‹ìŠ¤ ë”í‚¹ ì œë¡œ 355ml": 100,
            "í•«ì‹ìŠ¤ ë”í‚¹ ëŸ¬ì‰¬ 355ml": 100,
            "í•«ì‹ìŠ¤ ë”í‚¹ í¬ìŠ¤ 355ml": 100
        }

        # ì œí’ˆ ì„ íƒ ë° ìë™ ì¶”ê°€
        selected_product = st.selectbox("ì œí’ˆ ì„ íƒ", ["ì„ íƒ ì•ˆ í•¨"] + list(products.keys()), key="product_select")
        if selected_product != "ì„ íƒ ì•ˆ í•¨":
            if st.button("ì„ íƒí•œ ì œí’ˆ ì¶”ê°€"):
                caffeine_value = products[selected_product]
                st.session_state.selected_products.append((selected_product, caffeine_value))
                st.session_state.intake_input += caffeine_value
                st.success(f"{selected_product} ì¶”ê°€ë¨ (+{caffeine_value}mg)")

        # ------------------- ìˆ˜ë™ ì…ë ¥ ì¶”ê°€ -------------------
        st.markdown("---")
        st.write("ì§ì ‘ mg ë‹¨ìœ„ë¡œ ì¶”ê°€í•˜ê¸°")
        manual_value = st.number_input("ì§ì ‘ ì…ë ¥ (mg)", min_value=0, step=10, key="manual_add_value")
        if st.button("ì§ì ‘ ì¶”ê°€"):
            if manual_value > 0:
                st.session_state.selected_products.append((f"ìˆ˜ë™ ì…ë ¥ {manual_value}mg", manual_value))
                st.session_state.intake_input += manual_value
                st.success(f"ìˆ˜ë™ ì…ë ¥ìœ¼ë¡œ +{manual_value}mg ì¶”ê°€ë¨")

        # ------------------- ê²°ê³¼ í‘œì‹œ -------------------
        if st.session_state.selected_products:
            st.write("### ì˜¤ëŠ˜ ì¶”ê°€í•œ í•­ëª©")
            for name, mg in st.session_state.selected_products:
                st.write(f"- {name}: {mg}mg")
            st.metric(label="ì´ ì„­ì·¨ëŸ‰", value=f"{st.session_state.intake_input} mg")

        # ì €ì¥ / ì·¨ì†Œ / í™ˆìœ¼ë¡œ
        col1, col2, col3 = st.columns(3)
        with col1:
            if st.button("ì €ì¥"):
                achieved = st.session_state.intake_input <= goal
                st.session_state.data[date] = {
                    "goal": goal,
                    "intake": st.session_state.intake_input,
                    "achieved": achieved,
                    "products": st.session_state.selected_products.copy()
                }
                with open(DATA_FILE, "w", encoding="utf-8") as f:
                    json.dump(st.session_state.data, f, ensure_ascii=False, indent=2)
                del st.session_state.selected_date
                st.success(f"{date} ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")
        with col2:
            if st.button("ì·¨ì†Œ"):
                del st.session_state.selected_date
        with col3:
            if st.button("ğŸ  í™ˆìœ¼ë¡œ"):
                st.session_state.page = "home"
                if "selected_date" in st.session_state:
                    del st.session_state.selected_date

    st.markdown("---")
    if st.button("ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°", use_container_width=True):
        st.session_state.page = "home"

# ------------------- ì¹´í˜ì¸ ì•„ì¹´ì´ë¸Œ -------------------
elif st.session_state.page == "archive":
    st.title("ğŸ“š ì¹´í˜ì¸ ì•„ì¹´ì´ë¸Œ")

    # ë³¸ë¬¸ì´ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ â†’ ëª©ë¡ í™”ë©´
    if st.session_state.selected_article is None:
        st.write("ì¹´í˜ì¸ ê´€ë ¨ ì •ë³´ë¥¼ ì„ íƒí•˜ì„¸ìš”:")
        for title in archive_articles.keys():
            if st.button(title, use_container_width=True):
                st.session_state.selected_article = title
                st.rerun()

        st.markdown("---")
        if st.button("ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°", use_container_width=True):
            st.session_state.page = "home"

    # ë³¸ë¬¸ì´ ì„ íƒëœ ìƒíƒœ â†’ ê¸€ ë³´ê¸° í™”ë©´
    else:
        title = st.session_state.selected_article
        st.header(title)
        st.markdown(archive_articles[title])
        st.markdown("---")
        if st.button("â¬… ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°"):
            st.session_state.selected_article = None
            st.rerun()

